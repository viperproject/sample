meta version "v2.2,nothing";
meta name "Fruit Ninja";
meta icon "add";
meta color "#ff00cc99";
//
meta platform "current";
var board : Board {
}

action evolveee(sprite: Sprite) {
  $x := 150 + math→random(500);
  $sprite→set_pos($x, 850);
  $speedx := - 50 + math→random(100);
  $sprite→set_speed($speedx, - 800);
  meta private;
}

action main() {
  code→mainpg;
  data→sprite_set := data→board→create_sprite_set;
  data→pic2 := art→apple;
  data→pic1 := art→pear;
  data→pic := art→orange;
  for 0 ≤ i < 1 do {
    $sprite := data→board→create_picture(data→pic1);
    $sprite3 := data→board→create_picture(data→pic2);
    $sprite2 := data→board→create_picture(data→pic);
    data→sprite_set→add($sprite2);
    data→sprite_set→add($sprite);
    data→sprite_set→add($sprite3);
  }
  data→board→set_gravity(0, 400);
  foreach sprite4 in data→sprite_set where true do {
    code→evolveee($sprite4);
  }
  data→score := 0;
  data→life := 3;
}
var sprite_set : Sprite_Set {
}

action shoot_and_kill(sprite: Sprite) {
  foreach sprite1 in data→sprite_set where true do {
    code→evolveee($sprite);
    data→score := data→score + 1;
  }
  meta private;
}
var apple : Picture {
  is\_resource = true;
  url = "http://ts4.mm.bing.net/th?id=I.5019383028583608&pid=15.1&W=160&H=160";
}
var pear : Picture {
  is\_resource = true;
  url = "http://m.bing.com/search/Thumbnail.aspx?c=IOoEStvw&w=320&h=480&i=http%3A%2F%2Fwww.pachd.com%2Ffree-images%2Ffood-images%2Fpear-01.jpg";
}
var orange : Picture {
  is\_resource = true;
  url = "http://m.bing.com/search/Thumbnail.aspx?c=qHiOIZxr&w=320&h=480&i=http%3A%2F%2Fwww.pachd.com%2Ffree-images%2Ffood-images%2Fasian-pear-01.jpg";
}
var score : Number {
}
var life : Number {
}

event gameloop() {
  if data→score > 100 then {
    data→board→set_gravity(0, 450);
  }
  if data→score > 250 then {
    data→board→set_gravity(0, 500);
  }
  if data→score > 500 then {
    data→board→set_gravity(0, 600);
  }
  data→board→evolve;
  data→board→update_on_wall;
  foreach sprite in data→sprite_set where true do {
    if $sprite→y > 800 and $sprite→speed_y > 0 then {
      data→life := data→life - 1;
      $sprite1 := data→board→create_text(100, 20, 40, data→life→to_string);
      $sprite1→set_pos(430, 50);
      $sprite1→set_color(colors→black);
      art→a→play;
      code→evolveee($sprite);
    }
    else {
      if data→life < 1 then {
        data→score→post_to_wall;
        bazaar→post_leaderboard_score(data→score);
        wall→clear;
        bazaar→post_leaderboard_to_wall;
        time→stop;
      }
    }
  }
  data→board→set_background(colors→white);
  meta private;
}

event tap_sprite_in_sprite_set(sprite: Sprite, index_in_set: Number, x: Number, y: Number) {
  code→shoot_and_kill($sprite);
  data→text := data→board→create_text(100, 20, 40, data→score→to_string);
  data→text→set_pos(50, 50);
  data→text→set_color(colors→black);
  meta private;
}
var a : Sound {
  is\_resource = true;
  url = "http://www.shockwave-sound.com/sound-effects/scream-sounds/Ouche.wav";
}
var pic1 : Picture {
}
var pic : Picture {
}
var pic2 : Picture {
}
var text : Sprite {
}

event swipe_sprite_in_sprite_set(sprite: Sprite, index_in_set: Number, x: Number, y: Number, delta_x: Number, delta_y: Number) {
  code→shoot_and_kill($sprite);
  meta private;
}
var main_tile : Tile {
  readonly = true;
}

action tile() {
  data→main_tile→set_icon(art→ninja);
  data→main_tile→set_back_icon(art→ninja);
  meta private;
}
var ninja : Picture {
  is\_resource = true;
  url = "http://ts2.mm.bing.net/th?id=I.4552700498808062&pid=15.1&W=160&H=160";
}

action mainpg() {
  code→tile;
  data→board := media→create_landscape_board(800, 480);
  data→board→post_to_wall;
  meta private;
}
var main2 : Picture {
  is\_resource = true;
  url = "http://m.bing.com/search/Thumbnail.aspx?c=zXmfiAYo&w=320&h=480&i=http%3A%2F%2Fimages.wikia.com%2Fgalaxytabgaming%2Fimages%2F8%2F82%2FFruitNinjaMainMenu.png";
}
var main_menu : Sprite_Set {
}

