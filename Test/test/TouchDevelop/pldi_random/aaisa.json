{"textVersion":"v2.2,js,ctx","jsonVersion":"v0.0,resolved","name":"oauth v2","comment":"OAuth 2.0 allows to build apps for Live, Facebook or Google.","icon":"Wifi","color":"#ff00CC99","autoIcon":"Wifi","autoColor":"#00CC99","platform":"current","rootId":"x3sTpkk7N0pcJXnyf5NFxXpV","showAd":false,"isLibrary":false,"allowExport":false,"hasUniqueIds":false,"decls":[{"name":"main","inParameters":[],"outParameters":[],"isPrivate":false,"isOffloaded":false,"isTest":false,"isAsync":false,"nodeType":"action","body":[{"text":"OAuth v2.0 is a common authentication mechanism supported by Live Connect, Facebook and Google. TouchDevelop supports the [OAuth 2.0](http://tools.ietf.org/html/rfc6749) Implicit grant flow protocol as defined in [section 4.2](http://tools.ietf.org/html/rfc6749#section-4.2).","nodeType":"comment","id":"60"},{"text":"## Registering your apps","nodeType":"comment","id":"61"},{"text":"**This step is VERY IMPORTANT.**","nodeType":"comment","id":"62"},{"text":"Register an app for OAuth using the usual instructions provided by the service you want to use.","nodeType":"comment","id":"63"},{"text":"In the settings of your application, you MUST enter precisely the following redirect uri.","nodeType":"comment","id":"64"},{"text":"* https://www.touchdevelop.com/{var:userid}/oauth","nodeType":"comment","id":"65"},{"text":"> where '{var:userid}' is your TouchDevelop user `id`.","nodeType":"comment","id":"66"},{"text":"Only TouchDevelop scripts published under your account will be able to use this redirect uri.","nodeType":"comment","id":"67"},{"text":"## Authenticating","nodeType":"comment","id":"68"},{"text":"The OAuth 2.0 authentication is handled through the `web->oauth_v2` action. The action takes the OAuth URL including the `client_id` and optional `scope` or other arguments. Do NOT include the `state` and `redirect_uri` arguments; they are automatically added by TouchDevelop.","nodeType":"comment","id":"69"},{"text":"{hide}","nodeType":"comment","id":"6a"},{"expr":{"tokens":[{"nodeType":"localRef","name":"url","localId":"20","id":"6e0"},{"op":":=","nodeType":"operator","id":"6d1"},{"nodeType":"stringLiteral","value":"","id":"6e1"}],"tree":{"name":":=","parent":"Unknown","nodeType":"call","args":[{"nodeType":"localRef","name":"url","localId":"20","id":"6e0"},{"nodeType":"stringLiteral","value":"","id":"6e1"}],"id":"6d"},"locals":[{"name":"url","type":"String","nodeType":"localDef","id":"20"}],"nodeType":"exprHolder","id":"6c"},"nodeType":"exprStmt","id":"6b"},{"text":"{/hide}","nodeType":"comment","id":"6e"},{"expr":{"tokens":[{"nodeType":"localRef","name":"oauth res","localId":"21","id":"6i0"},{"op":":=","nodeType":"operator","id":"6h1"},{"nodeType":"singletonRef","name":"web","type":"Web","id":"6i20"},{"name":"oauth v2","parent":"Web","nodeType":"propertyRef","id":"6h3"},{"op":"(","nodeType":"operator","id":"6h4"},{"nodeType":"localRef","name":"url","localId":"20","id":"6i21"},{"op":")","nodeType":"operator","id":"6h6"}],"tree":{"name":":=","parent":"Unknown","nodeType":"call","args":[{"nodeType":"localRef","name":"oauth res","localId":"21","id":"6i0"},{"name":"oauth v2","parent":"Web","nodeType":"call","args":[{"nodeType":"singletonRef","name":"web","type":"Web","id":"6i20"},{"nodeType":"localRef","name":"url","localId":"20","id":"6i21"}],"id":"6i1"}],"id":"6h"},"locals":[{"name":"oauth res","type":"OAuth Response","nodeType":"localDef","id":"21"}],"nodeType":"exprHolder","id":"6g"},"nodeType":"exprStmt","id":"6f"},{"text":"The response contains the access token or the details about the error if any. You can then use the access token to sign each request as specified by the service.","nodeType":"comment","id":"6i"},{"expr":{"tokens":[{"nodeType":"localRef","name":"access token","localId":"22","id":"6m0"},{"op":":=","nodeType":"operator","id":"6l1"},{"nodeType":"localRef","name":"oauth res","localId":"21","id":"6m20"},{"name":"access token","parent":"OAuth Response","nodeType":"propertyRef","id":"6l3"}],"tree":{"name":":=","parent":"Unknown","nodeType":"call","args":[{"nodeType":"localRef","name":"access token","localId":"22","id":"6m0"},{"name":"access token","parent":"OAuth Response","nodeType":"call","args":[{"nodeType":"localRef","name":"oauth res","localId":"21","id":"6m20"}],"id":"6m1"}],"id":"6l"},"locals":[{"name":"access token","type":"String","nodeType":"localDef","id":"22"}],"nodeType":"exprHolder","id":"6k"},"nodeType":"exprStmt","id":"6j"},{"expr":{"tokens":[{"nodeType":"localRef","name":"call","localId":"23","id":"6p0"},{"op":":=","nodeType":"operator","id":"6o1"},{"nodeType":"stringLiteral","value":"http://....?access_token=","id":"6p20"},{"op":"∥","nodeType":"operator","id":"6o3"},{"nodeType":"singletonRef","name":"web","type":"Web","id":"6p220"},{"name":"url encode","parent":"Web","nodeType":"propertyRef","id":"6o5"},{"op":"(","nodeType":"operator","id":"6o6"},{"nodeType":"localRef","name":"access token","localId":"22","id":"6p221"},{"op":")","nodeType":"operator","id":"6o8"}],"tree":{"name":":=","parent":"Unknown","nodeType":"call","args":[{"nodeType":"localRef","name":"call","localId":"23","id":"6p0"},{"name":"∥","parent":"String","nodeType":"call","args":[{"nodeType":"stringLiteral","value":"http://....?access_token=","id":"6p20"},{"name":"url encode","parent":"Web","nodeType":"call","args":[{"nodeType":"singletonRef","name":"web","type":"Web","id":"6p220"},{"nodeType":"localRef","name":"access token","localId":"22","id":"6p221"}],"id":"6p21"}],"id":"6p1"}],"id":"6o"},"locals":[{"name":"call","type":"String","nodeType":"localDef","id":"23"}],"nodeType":"exprHolder","id":"6n"},"nodeType":"exprStmt","id":"6m"},{"text":"You can use the `is expiring` action to easily test if an access token is missing or (almost expired).","nodeType":"comment","id":"6p"},{"nodeType":"if","condition":{"tokens":[{"nodeType":"localRef","name":"oauth res","localId":"21","id":"6t0"},{"name":"is expiring","parent":"OAuth Response","nodeType":"propertyRef","id":"6s1"},{"op":"(","nodeType":"operator","id":"6s2"},{"op":"1","nodeType":"operator","id":"6s3"},{"op":"0","nodeType":"operator","id":"6s4"},{"op":"0","nodeType":"operator","id":"6s5"},{"op":")","nodeType":"operator","id":"6s6"}],"tree":{"name":"is expiring","parent":"OAuth Response","nodeType":"call","args":[{"nodeType":"localRef","name":"oauth res","localId":"21","id":"6t0"},{"nodeType":"numberLiteral","value":100,"id":"6t1"}],"id":"6s"},"locals":[],"nodeType":"exprHolder","id":"6r"},"thenBody":[{"text":"Oops, better ask for a new token.","nodeType":"comment","id":"6u0"}],"isElseIf":false,"id":"6q"},{"text":"## Libraries","nodeType":"comment","id":"6v"},{"text":"The following libraries already implement the OAuth 2.0 authentication for a number","nodeType":"comment","id":"6w"},{"text":"of APIs. Each library contains detailled instructions on how to register an","nodeType":"comment","id":"6x"},{"text":"application in order to use them.","nodeType":"comment","id":"6y"},{"text":"* [Facebook](/script:fwln)","nodeType":"comment","id":"6z"},{"text":"* [Google](/script:lhsv)","nodeType":"comment","id":"6A"}],"id":"1"}],"deletedDecls":[],"nodeType":"app","id":"app"}
